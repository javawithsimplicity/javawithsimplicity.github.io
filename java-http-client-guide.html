<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Java HTTP Client guide | Java with simplicity</title>
<meta name="generator" content="Jekyll v4.2.1" />
<meta property="og:title" content="Java HTTP Client guide" />
<meta name="author" content="Felipe Videira" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Learn to use the HTTP Client introduced in Java 11." />
<meta property="og:description" content="Learn to use the HTTP Client introduced in Java 11." />
<link rel="canonical" href="https://javawithsimplicity.github.io/java-http-client-guide" />
<meta property="og:url" content="https://javawithsimplicity.github.io/java-http-client-guide" />
<meta property="og:site_name" content="Java with simplicity" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-03-15T09:00:00-03:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Java HTTP Client guide" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Felipe Videira"},"dateModified":"2022-03-15T09:00:00-03:00","datePublished":"2022-03-15T09:00:00-03:00","description":"Learn to use the HTTP Client introduced in Java 11.","headline":"Java HTTP Client guide","mainEntityOfPage":{"@type":"WebPage","@id":"https://javawithsimplicity.github.io/java-http-client-guide"},"url":"https://javawithsimplicity.github.io/java-http-client-guide"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://javawithsimplicity.github.io/feed.xml" title="Java with simplicity" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Java with simplicity</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Java HTTP Client guide</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2022-03-15T09:00:00-03:00" itemprop="datePublished">Mar 15, 2022
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Felipe Videira</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="introduction">Introduction</h2>

<p>The HTTP Client was introduced in Java 11 (September 2018) to offer a simpler way to perform HTTP requests than with previously available classes and methods, which were verbose, complex, and outdated (<code class="language-plaintext highlighter-rouge">HttpURLConnection</code> API).</p>

<p>The main solution adopted until then for Java projects was using external HTTP clients like Apache HttpClient and Spring RestTemplate.</p>

<p>Thus, this new standard API ends the need to add dependencies for this simple purpose.</p>

<p>The newer API supports synchronous and asynchronous programming, has many useful methods, and is compatible with HTTP/1.1 and HTTP/2.</p>

<h2 id="performing-a-basic-request">Performing a basic request</h2>

<p>An example of performing a GET request and printing the response body to the console:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">HttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="nc">HttpClient</span><span class="o">.</span><span class="na">newHttpClient</span><span class="o">();</span>
<span class="nc">HttpRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="nc">HttpRequest</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">uri</span><span class="o">(</span><span class="no">URI</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"https://example.com/"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="nc">HttpResponse</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="nc">BodyHandlers</span><span class="o">.</span><span class="na">ofString</span><span class="o">());</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"response body: "</span> <span class="o">+</span> <span class="n">response</span><span class="o">.</span><span class="na">body</span><span class="o">());</span></code></pre></figure>

<p>It was not necessary to specify the HTTP method as GET because it is the default method.</p>

<p>As the example shows, the HTTP Client is based on the main classes <code class="language-plaintext highlighter-rouge">HttpClient</code>, <code class="language-plaintext highlighter-rouge">HttpRequest</code>, and <code class="language-plaintext highlighter-rouge">HttpResponse</code>.</p>

<h2 id="httpclient-creation">HttpClient creation</h2>

<p>To perform a request, a <code class="language-plaintext highlighter-rouge">HttpClient</code> instance is necessary. There are two static methods to get it.</p>

<p>The <code class="language-plaintext highlighter-rouge">HttpClient.newHttpClient()</code> creates a default <code class="language-plaintext highlighter-rouge">HttpClient</code>, which suits most cases.</p>

<p>The <code class="language-plaintext highlighter-rouge">HttpClient.newBuilder()</code> returns a builder for more specific settings like HTTP version, connect timeout, a proxy, redirection policy, CookieHandler, HTTP authentication, and more.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">HttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="nc">HttpClient</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">followRedirects</span><span class="o">(</span><span class="nc">Redirect</span><span class="o">.</span><span class="na">NORMAL</span><span class="o">)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span></code></pre></figure>

<h2 id="httprequest-creation">HttpRequest creation</h2>

<p>A request to be performed is represented by the <code class="language-plaintext highlighter-rouge">HttpRequest</code> class. It is created by the request builder, and with that we define the URI, request method, body, headers, request timeout, and HTTP version.</p>

<p>The <code class="language-plaintext highlighter-rouge">HttpRequest.newBuilder()</code> method creates a builder.</p>

<p>Alternatively, there is the <code class="language-plaintext highlighter-rouge">HttpRequest.newBuilder(URI uri)</code> which already receives the URI as a parameter for a shorter code.</p>

<h2 id="setting-a-request-header">Setting a request header</h2>

<p>A header can be set with the <code class="language-plaintext highlighter-rouge">header(String name, String value)</code> method of the request builder.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">HttpRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="nc">HttpRequest</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">(</span><span class="no">URI</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"https://example.com/api/products"</span><span class="o">))</span>
        <span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">"Authorization"</span><span class="o">,</span> <span class="s">"Bearer 6f0e91f1-b237-45dc-a462-5b6bd1bf9747"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span></code></pre></figure>

<h2 id="setting-the-http-method-and-body-of-a-request">Setting the HTTP method and body of a request</h2>

<p>To set an HTTP method for a request, the builder has methods with the equivalent name: GET, POST, PUT, and DELETE.</p>

<p>The request body is passed as a parameter in a <code class="language-plaintext highlighter-rouge">BodyPublisher</code>. To create a <code class="language-plaintext highlighter-rouge">BodyPublisher</code> instance, the <code class="language-plaintext highlighter-rouge">BodyPublishers</code> class has static methods like <code class="language-plaintext highlighter-rouge">ofString(String body)</code>, <code class="language-plaintext highlighter-rouge">ofByteArray(byte[] buf)</code>, and others. And there is the static method <code class="language-plaintext highlighter-rouge">noBody()</code> to perform the request without a body.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">HttpRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="nc">HttpRequest</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">(</span><span class="no">URI</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"https://example.com/api/products"</span><span class="o">))</span>
        <span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">"Content-Type"</span><span class="o">,</span> <span class="s">"application/json"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">POST</span><span class="o">(</span><span class="nc">BodyPublishers</span><span class="o">.</span><span class="na">ofString</span><span class="o">(</span><span class="s">"{\"message\": \"Test.\"}"</span><span class="o">))</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span></code></pre></figure>

<p>The builder also has the <code class="language-plaintext highlighter-rouge">method(String method, BodyPublisher bodyPublisher)</code>, which receives the HTTP method name as a <code class="language-plaintext highlighter-rouge">String</code>.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">HttpRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="nc">HttpRequest</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">(</span><span class="no">URI</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"https://example.com/api/products/1"</span><span class="o">))</span>
        <span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">"Content-Type"</span><span class="o">,</span> <span class="s">"application/json"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="s">"POST"</span><span class="o">,</span> <span class="nc">BodyPublishers</span><span class="o">.</span><span class="na">ofString</span><span class="o">(</span><span class="s">"{\"message\": \"Test.\"}"</span><span class="o">))</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span></code></pre></figure>

<h2 id="request-timeout">Request timeout</h2>

<p>The <code class="language-plaintext highlighter-rouge">HttpRequest</code> builder has the <code class="language-plaintext highlighter-rouge">timeout</code> method, which receives the time as a <code class="language-plaintext highlighter-rouge">java.time.Duration</code>. The time can be obtained with methods like <code class="language-plaintext highlighter-rouge">Duration.ofMinutes(2)</code> and <code class="language-plaintext highlighter-rouge">Duration.ofSeconds(45)</code>.</p>

<p>The <code class="language-plaintext highlighter-rouge">HttpTimeoutException</code> is used when the time limit is reached before the response is received.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">HttpRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="nc">HttpRequest</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">(</span><span class="no">URI</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"https://example.com/api/products"</span><span class="o">))</span>
        <span class="o">.</span><span class="na">timeout</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="na">ofMinutes</span><span class="o">(</span><span class="mi">2</span><span class="o">))</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span></code></pre></figure>

<p>Without setting a timeout, the request will wait infinitely for a response.</p>

<h2 id="bodyhandler-implementations">BodyHandler implementations</h2>

<p><code class="language-plaintext highlighter-rouge">BodyHandler</code> is an interface that defines how the response body of the request will be managed.</p>

<p>The <code class="language-plaintext highlighter-rouge">HttpClient</code> methods that perform the requests receive a <code class="language-plaintext highlighter-rouge">BodyHandler</code>.</p>

<p>The <code class="language-plaintext highlighter-rouge">BodyHandlers</code> class has static methods that offer <code class="language-plaintext highlighter-rouge">BodyHandler</code> implementations like <code class="language-plaintext highlighter-rouge">ofString()</code>, <code class="language-plaintext highlighter-rouge">ofByteArray()</code>, <code class="language-plaintext highlighter-rouge">ofInputStream()</code>, and others.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">HttpResponse</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">response1</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="nc">HttpResponse</span><span class="o">.</span><span class="na">BodyHandlers</span><span class="o">.</span><span class="na">ofString</span><span class="o">());</span>
<span class="nc">HttpResponse</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">response2</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="nc">HttpResponse</span><span class="o">.</span><span class="na">BodyHandlers</span><span class="o">.</span><span class="na">ofByteArray</span><span class="o">());</span></code></pre></figure>

<h2 id="asynchronous-request">Asynchronous request</h2>

<p>The <code class="language-plaintext highlighter-rouge">HttpClient</code> has the <code class="language-plaintext highlighter-rouge">sendAsync(HttpRequest request, BodyHandler&lt;T&gt; responseBodyHandler)</code> method, which returns a <code class="language-plaintext highlighter-rouge">CompletableFuture</code> and performs the request asynchronously.</p>

<p><code class="language-plaintext highlighter-rouge">CompletableFuture</code> is a class designed for asynchronous programming. It represents the result of an operation performed asynchronously and offers useful methods to handle successful results and errors.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">HttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="nc">HttpClient</span><span class="o">.</span><span class="na">newHttpClient</span><span class="o">();</span>
<span class="nc">HttpRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="nc">HttpRequest</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">(</span><span class="no">URI</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"https://example.com/api/products"</span><span class="o">)).</span><span class="na">build</span><span class="o">();</span>
<span class="nc">CompletableFuture</span><span class="o">&lt;</span><span class="nc">HttpResponse</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="n">future</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">sendAsync</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="nc">BodyHandlers</span><span class="o">.</span><span class="na">ofString</span><span class="o">());</span>
<span class="n">future</span><span class="o">.</span><span class="na">thenAccept</span><span class="o">(</span><span class="n">response</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"response body: "</span> <span class="o">+</span> <span class="n">response</span><span class="o">.</span><span class="na">body</span><span class="o">()));</span></code></pre></figure>

<p>The <code class="language-plaintext highlighter-rouge">thenAccept(Consumer&lt;? super T&gt; action)</code> method will execute the received <code class="language-plaintext highlighter-rouge">Consumer</code> once the request is finished successfully.</p>

<h2 id="httpresponse">HttpResponse</h2>

<p>The <code class="language-plaintext highlighter-rouge">HttpResponse</code> is returned when sending the request and has methods to get the response status code, body, and headers, as well as the request data.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nc">HttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="nc">HttpClient</span><span class="o">.</span><span class="na">newHttpClient</span><span class="o">();</span>
<span class="nc">HttpRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="nc">HttpRequest</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">(</span><span class="no">URI</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"https://example.com/"</span><span class="o">)).</span><span class="na">build</span><span class="o">();</span>
<span class="nc">HttpResponse</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="nc">BodyHandlers</span><span class="o">.</span><span class="na">ofString</span><span class="o">());</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"status code: "</span> <span class="o">+</span> <span class="n">response</span><span class="o">.</span><span class="na">statusCode</span><span class="o">());</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"headers: "</span> <span class="o">+</span> <span class="n">response</span><span class="o">.</span><span class="na">headers</span><span class="o">());</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"response body: "</span> <span class="o">+</span> <span class="n">response</span><span class="o">.</span><span class="na">body</span><span class="o">());</span></code></pre></figure>

<h2 id="briefer-code-with-static-imports">Briefer code with static imports</h2>

<p>The HTTP Client is much simpler than the old classes and methods, but actually it is still verbose. And used frequently, such as in endpoint test code, the problem gets worse.</p>

<p>The code can become more succinct by using static imports without losing readability.</p>

<p>Then let’s use static import for the methods <code class="language-plaintext highlighter-rouge">HttpClient.newHttpClient()</code> and <code class="language-plaintext highlighter-rouge">HttpRequest.newBuilder​(URI uri)</code> and pass the <code class="language-plaintext highlighter-rouge">HttpRequest</code> as a parameter directly without assigning it to a variable:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kt">var</span> <span class="n">response</span> <span class="o">=</span> <span class="n">newHttpClient</span><span class="o">().</span><span class="na">send</span><span class="o">(</span><span class="n">newBuilder</span><span class="o">(</span><span class="no">URI</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"https://example.com/api/products"</span><span class="o">)).</span><span class="na">build</span><span class="o">(),</span>
        <span class="nc">BodyHandlers</span><span class="o">.</span><span class="na">ofString</span><span class="o">());</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"response body: "</span> <span class="o">+</span> <span class="n">response</span><span class="o">.</span><span class="na">body</span><span class="o">());</span></code></pre></figure>

<p>Thus the HTTP Client becomes more compelling.</p>

<h2 id="conclusion">Conclusion</h2>

<p>In this guide, we learned how to use the Java HTTP Client to perform HTTP requests and its main features.</p>

  </div><a class="u-url" href="/java-http-client-guide" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Java with simplicity</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Java with simplicity</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/felvid"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">felvid</span></a></li><li><a href="https://www.twitter.com/fel_vid"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">fel_vid</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Learn to develop software using Java at a higher level of quality by leveraging lightweight libraries, functional programming, and vanilla Java.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
